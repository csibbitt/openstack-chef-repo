TODO
==
* Cinder in dashboard
* proper repo
* passwords & secrets
* vagrant alongside
* test / contribute openstack-compute/recipes/nova-setup.rb --pool for add_floaters
* cinder clear ionice patch
* heat
* ddns when floating IP associated
* fwaas
* lbaas

MOAR BOXES:
* OMD w/ raid alerts
* Dev box (bleeding ubuntu)
* btcd
* freepbx
* sleeper
* Public LAMP webserver
* Private LAMP webserver
* KSP server
* Backup to Amazon $60/yr


-=-=-=-=-=-=-=-=-=-=-

Boot the installer
==
Start w/ Ubuntu 14.04 Server (SSH packages only) 
I booted Non-UEFI to simplify disk partitioning

SW RAID + LVM Setup
==
Majority of space an unused LVM partition for cinder
40G for base system (initial install is ~5G)
+ image space
+ snapshot space
+ object storage
On 2T I put 1.5T for cinder
* 3 RAID1: swap(16G), root(500G), cinder(1.5T)
* Format swap
* 2 VGs: ROOT_VG, CINDER_LVM_ISCSI_DAS_RAID1_VG
* 1 LV: ROOTFS_LV

Get updates
==
sudo aptitude update && sudo aptitude upgrade
sudo reboot 
(new kernel)

Take ownership of /usr/local/src and work there
==
cd /usr/local/src
sudo chown `whoami` .

Install chefDK
==
wget https://opscode-omnibus-packages.s3.amazonaws.com/ubuntu/12.04/x86_64/chefdk_0.4.0-1_amd64.deb
sudo dpkg -i chefdk_0.4.0-1_amd64.deb

Get stackforge repo & deps
==
sudo aptitude install git
git clone https://github.com/stackforge/openstack-chef-repo.git openstack-chef-repo
berks vendor ./cookbooks

Customize
==
Created environments/fractalcube-aio-neutron.json

Hack
==
/usr/local/src/openstack-chef-repo/*.diff (Required l3_agent.rb.diff before chef client run)
/etc/init/plymouth-upstart-bridge.conf (http://www.unrelatedshit.com/2014/07/30/kvm-too-fast-for-plymouth-upstart-bridge/)
/lib/udev/rules.d/95-multipath.rules (https://bugs.launchpad.net/ubuntu/+source/multipath-tools/+bug/1240049)

Prepare 
==
export EDITOR=vim
knife node create -z stacker.fractalcube
  "chef_environment": "fractalcube-aio-neutron",
  "run_list": ["role[allinone-compute]","role[os-image-upload]"]

Preview
==
sudo chef-client -z -o fractalcube-openstack::install-mysql2-gem
sudo chef-client -z -W --force-formatter | less -r

Go for it
==
sudo chef-client -z --force-formatter | tee ~/first-chef-run.out | less -r

Move static ip to external bridge
==
vim /etc/network/interfaces
vim /etc/rc.local

Get auth details for the admin project
==
sudo cp ~root/openrc ./openrc-admin
sudo chown `id -u` openrc-admin
. ./openrc-admin

Create initial network + subnet
==
neutron net-create "Home LAN" --router:external True --provider:physical_network default --provider:network_type flat
neutron subnet-create "Home LAN" --name ext-subnet --allocation-pool start=192.168.2.150,end=192.168.2.180  --disable-dhcp --gateway 192.168.2.1 192.168.2.0/24

Create users and projects and routers
==


-=-=-=-=-=-=-=-=-=-=-


***** install vagrant
==
wget https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.2_x86_64.deb
sudo dpkg -i vagrant_1.7.2_x86_64.deb








